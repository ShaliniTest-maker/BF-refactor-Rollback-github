{#
Two-Factor Authentication Code Email Template - Plain Text Version
================================================================

This template provides secure OTP code delivery for MFA workflows in plain text format,
ensuring accessibility for text-only email clients while maintaining comprehensive
security instructions and authentication code visibility.

Template Features:
- Auth0 MFA integration support for TOTP and SMS authentication flows
- Clear OTP code presentation optimized for text-only email clients
- Security instructions and expiration information in accessible format
- Accessibility compliance for screen readers and text-based email systems
- Comprehensive authentication guidance and usage instructions

Usage Context:
- Two-factor authentication code delivery via email
- MFA workflow completion for enhanced account security
- Auth0 Python SDK 4.9.0 integration with OTP generation
- Flask-based authentication system OTP email delivery

Security Considerations:
- OTP codes are time-sensitive and expire automatically
- Codes should only be used for immediate authentication completion
- Users should never share authentication codes with others
- Email delivery provides backup authentication method for MFA flows
#}

{#- Extend base text email template -#}
{% extends "emails/base/base.txt" %}

{#- Email subject for two-factor authentication code -#}
{% block subject -%}
Your Two-Factor Authentication Code - {{ app_name | default('Flask Application') }}
{%- endblock %}

{#- Pre-header for email clients that support it -#}
{% block preheader -%}
Authentication code: {{ two_factor_code | default('XXXXXX') }} - Expires in {{ expiration_minutes | default('10') }} minutes
{%- endblock %}

{#- Main content with OTP code and instructions -#}
{% block content -%}
Hello {{ user_name | default('User') }},

You have requested a two-factor authentication code to complete your login.

===============================================================================
YOUR AUTHENTICATION CODE
===============================================================================

{{ two_factor_code | default('XXXXXX') }}

===============================================================================

{{ format_key_value('Authentication Code', two_factor_code | default('XXXXXX')) }}
{{ format_key_value('Valid Until', expiration_time | default('Not specified')) }}
{{ format_key_value('Requested From', user_ip | default('Unknown location')) }}
{{ format_key_value('Device', user_agent | default('Unknown device') | truncate(50)) }}

IMPORTANT SECURITY INFORMATION:
{{ create_section_divider('-', 40) }}

{{ format_list_item('This code is valid for ' + (expiration_minutes | default('10') | string) + ' minutes only') }}
{{ format_list_item('Use this code immediately to complete your login') }}
{{ format_list_item('Do not share this code with anyone') }}
{{ format_list_item('Our support team will never ask for authentication codes') }}
{{ format_list_item('If you did not request this code, secure your account immediately') }}

HOW TO USE YOUR AUTHENTICATION CODE:
{{ create_section_divider('-', 40) }}

1. Return to the login screen where you were prompted for the authentication code
2. Enter the 6-digit code exactly as shown above: {{ two_factor_code | default('XXXXXX') }}
3. Complete your login within {{ expiration_minutes | default('10') }} minutes
4. If the code expires, request a new one from the login screen

AUTHENTICATION CODE DETAILS:
{{ create_section_divider('-', 40) }}

{{ format_key_value('Code Type', 'Email-based Two-Factor Authentication') }}
{{ format_key_value('Security Level', 'Enhanced Account Protection') }}
{{ format_key_value('Generated At', generation_time | default(now() | strftime('%Y-%m-%d %H:%M:%S UTC'))) }}
{{ format_key_value('Delivery Method', 'Secure Email Transmission') }}

{%- endblock %}

{#- Additional security information block -#}
{% block additional_info -%}
ACCOUNT SECURITY BEST PRACTICES
{{ create_section_divider('-', 50) }}

{{ format_list_item('Enable two-factor authentication on all your accounts') }}
{{ format_list_item('Use unique passwords for each online service') }}
{{ format_list_item('Regularly review your account security settings') }}
{{ format_list_item('Keep your contact information up to date') }}
{{ format_list_item('Report suspicious activity immediately') }}

ALTERNATIVE AUTHENTICATION METHODS
{{ create_section_divider('-', 50) }}

If you cannot use this email code, you may also use:

{{ format_list_item('Authenticator app (Google Authenticator, Authy, etc.)') }}
{{ format_list_item('SMS text message to your registered phone number') }}
{{ format_list_item('Backup authentication codes (if previously generated)') }}

To manage your two-factor authentication settings:
{{ format_url_for_text(account_settings_url | default('https://app.company.com/security'), 'Account Security Settings') }}

{%- endblock %}

{#- Action items for user -#}
{% block action_items -%}
NEXT STEPS:
{{ create_section_divider('-', 20) }}

{{ format_list_item('Use the authentication code above to complete your login') }}
{{ format_list_item('Ensure you complete login within ' + (expiration_minutes | default('10') | string) + ' minutes') }}
{{ format_list_item('Save backup authentication codes for future use') }}
{{ format_list_item('Consider using an authenticator app for enhanced security') }}

IF YOU DID NOT REQUEST THIS CODE:
{{ create_section_divider('-', 40) }}

{{ format_list_item('Change your password immediately') }}
{{ format_list_item('Review recent account activity') }}
{{ format_list_item('Contact support if you notice unauthorized access') }}
{{ format_list_item('Consider enabling additional security measures') }}

{%- endblock %}

{#- Enhanced contact information for MFA support -#}
{% block contact_info -%}
NEED HELP WITH TWO-FACTOR AUTHENTICATION?

Security Support Team:
- Email: security@{{ company_domain | default('company.com') }}
- Phone: {{ support_phone | default('1-800-SUPPORT (1-800-786-7678)') }}
- Help Center: {{ help_center_url | default('https://help.company.com/mfa') }}

Two-Factor Authentication Guide:
{{ format_url_for_text(mfa_guide_url | default('https://help.company.com/mfa/setup'), 'MFA Setup Guide') }}

Account Recovery Options:
{{ format_url_for_text(recovery_url | default('https://app.company.com/recovery'), 'Account Recovery') }}

Business Hours: {{ support_hours | default('Monday - Friday, 9:00 AM - 6:00 PM EST') }}
Emergency Security Line: Available 24/7 for urgent security matters

{%- endblock %}

{#- Footer with enhanced security messaging -#}
{% block footer -%}

===============================================================================
{{ app_name | default('Flask Application') }} | Secure Authentication System
===============================================================================

This authentication code email was sent because a two-factor authentication
code was requested for your account. This is part of our enhanced security
measures to protect your account and personal information.

{% block unsubscribe_info -%}
Two-factor authentication emails are required for account security and cannot
be unsubscribed. To disable two-factor authentication, visit your account
security settings after logging in.

Account Security Settings: {{ account_settings_url | default('https://app.company.com/security') }}

{%- endblock %}

{% block legal_info -%}
Â© {% now 'Y' %} {{ company_name | default('Company Name') }}. All rights reserved.

This message contains a time-sensitive authentication code and is intended
only for {{ user_email | default('the account holder') }}. If you have 
received this message in error, please delete it immediately and contact
our security team.

SECURITY NOTICE: {{ company_name | default('Company Name') }} will never ask you to 
share authentication codes via email, phone, or any other communication method.
Keep your codes private and secure.

{%- endblock %}

{% block compliance_info -%}
{{ company_name | default('Company Name') }}
{{ company_address | default('123 Business Street\nCity, State 12345\nUnited States') }}

Authentication Code ID: {{ code_id | default('AUTH-' + now() | strftime('%Y%m%d-%H%M%S')) }}
Email Delivery ID: {{ delivery_id | default('EMAIL-' + now() | strftime('%Y%m%d-%H%M%S')) }}

For security auditing and compliance purposes, the delivery of this
authentication code has been logged with timestamp and recipient information.

{%- endblock %}
{%- endblock %}

{#- Technical headers for email tracking and security -#}
{% block technical_headers -%}
{#- Authentication code metadata for system tracking -#}
X-Auth-Code-Type: Two-Factor-Authentication
X-Auth-Code-Method: Email-Delivery
X-Auth-Code-Expiration: {{ expiration_time | default('Not specified') }}
X-Security-Level: Enhanced-MFA
X-Template-Version: two-factor-code-v1.0

{#- Integration with Auth0 MFA system -#}
X-Auth0-Integration: MFA-Email-Delivery
X-Flask-Auth-System: Two-Factor-Authentication
X-Security-Framework: {{ security_framework | default('Flask-Login + Auth0') }}

{%- endblock %}

{#-
Template Variables Reference:
=============================

Required Variables:
- two_factor_code: The 6-digit authentication code (e.g., "123456")
- user_name: Recipient's display name
- user_email: Recipient's email address

Optional Variables:
- app_name: Application name (default: "Flask Application")
- company_name: Company name (default: "Company Name")
- company_domain: Company domain (default: "company.com")
- expiration_minutes: Code validity in minutes (default: "10")
- expiration_time: Formatted expiration timestamp
- generation_time: Code generation timestamp
- user_ip: IP address of the authentication request
- user_agent: Browser/device information
- account_settings_url: URL to account security settings
- help_center_url: URL to help documentation
- mfa_guide_url: URL to MFA setup guide
- recovery_url: URL to account recovery
- support_phone: Support phone number
- support_hours: Support business hours
- code_id: Unique identifier for the authentication code
- delivery_id: Unique identifier for email delivery
- security_framework: Description of security framework in use

Integration Examples:
====================

Flask Route Integration:
```python
from flask import render_template

@auth_blueprint.route('/send-mfa-code', methods=['POST'])
def send_mfa_code():
    code = generate_mfa_code()
    
    email_content = render_template(
        'emails/auth/two_factor_code.txt',
        two_factor_code=code,
        user_name=current_user.name,
        user_email=current_user.email,
        expiration_minutes=10,
        user_ip=request.remote_addr,
        user_agent=request.headers.get('User-Agent')
    )
    
    send_email(current_user.email, email_content)
    return jsonify({'status': 'code_sent'})
```

Auth0 Integration:
```python
import auth0.v3.authentication

def send_auth0_mfa_code(user_id):
    auth0_client = auth0.v3.authentication.GetToken()
    code = auth0_client.generate_mfa_code(user_id)
    
    email_content = render_template(
        'emails/auth/two_factor_code.txt',
        two_factor_code=code['code'],
        expiration_time=code['expires_at'],
        security_framework='Auth0 MFA + Flask-Login'
    )
    
    return send_mfa_email(email_content)
```

Accessibility Features:
======================

1. Clear Visual Hierarchy:
   - Section dividers using consistent character patterns
   - Structured content blocks with proper spacing
   - Key information highlighted through formatting

2. Screen Reader Compatibility:
   - Descriptive section headers and labels
   - Logical content flow for sequential reading
   - Important information clearly separated and emphasized

3. Text-Only Client Optimization:
   - No reliance on HTML formatting or images
   - ASCII-based visual elements for structure
   - Consistent line length for readability

4. Security Information Clarity:
   - Step-by-step instructions for code usage
   - Clear warnings about code sharing and security
   - Multiple contact methods for assistance

5. Alternative Format Support:
   - Plain text format compatible with all email clients
   - Structured content that maintains meaning without styling
   - Complete information available in text-only format

This template ensures that two-factor authentication remains accessible and secure
across all email client types while providing comprehensive authentication guidance
and security best practices for users completing MFA workflows.
-#}