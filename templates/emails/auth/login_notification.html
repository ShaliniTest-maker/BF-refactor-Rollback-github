{% extends "emails/base/base.html" %}

{% block title %}Security Alert: Login Detected{% endblock %}

{% block email_label %}Security notification email about login activity{% endblock %}

{% block header_title %}Security Notification{% endblock %}

{% block email_styles %}
/* Additional styles for login notification template */
.security-alert {
    background-color: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 6px;
    padding: 20px;
    margin: 20px 0;
}

.security-alert.high-risk {
    background-color: #f8d7da;
    border-color: #f5c6cb;
}

.security-alert.success {
    background-color: #d4edda;
    border-color: #c3e6cb;
}

.security-icon {
    display: inline-block;
    width: 24px;
    height: 24px;
    margin-right: 10px;
    vertical-align: middle;
}

.login-details {
    background-color: #f8f9fa;
    border-radius: 6px;
    padding: 20px;
    margin: 20px 0;
    border-left: 4px solid #007bff;
}

.detail-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 12px;
    border-bottom: 1px solid #e9ecef;
    padding-bottom: 8px;
}

.detail-row:last-child {
    margin-bottom: 0;
    border-bottom: none;
    padding-bottom: 0;
}

.detail-label {
    font-weight: 600;
    color: #495057;
    width: 35%;
}

.detail-value {
    color: #212529;
    width: 65%;
    text-align: right;
}

.action-buttons {
    text-align: center;
    margin: 30px 0;
}

.btn-security {
    background-color: #dc3545;
    color: #ffffff;
    margin: 0 10px 10px 0;
}

.btn-secure-account {
    background-color: #28a745;
    color: #ffffff;
    margin: 0 10px 10px 0;
}

.security-tips {
    background-color: #e3f2fd;
    border-radius: 6px;
    padding: 20px;
    margin: 20px 0;
}

.security-tips ul {
    margin: 10px 0;
    padding-left: 20px;
}

.security-tips li {
    margin-bottom: 8px;
    line-height: 1.5;
}

.suspicious-activity {
    background-color: #ffebee;
    border: 2px solid #f44336;
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
    text-align: center;
}

.suspicious-activity .warning-icon {
    font-size: 48px;
    color: #f44336;
    margin-bottom: 10px;
}

/* Dark mode support for security elements */
@media (prefers-color-scheme: dark) {
    .security-alert {
        background-color: #3d3d00 !important;
        border-color: #666600 !important;
        color: #ffffff !important;
    }
    
    .security-alert.high-risk {
        background-color: #4d1f1f !important;
        border-color: #662d2d !important;
    }
    
    .security-alert.success {
        background-color: #1f4d1f !important;
        border-color: #2d662d !important;
    }
    
    .login-details {
        background-color: #2d2d2d !important;
        border-color: #007bff !important;
    }
    
    .detail-label,
    .detail-value {
        color: #ffffff !important;
    }
    
    .detail-row {
        border-color: #404040 !important;
    }
    
    .security-tips {
        background-color: #1a2d3d !important;
        color: #ffffff !important;
    }
    
    .suspicious-activity {
        background-color: #3d1a1a !important;
        border-color: #f44336 !important;
        color: #ffffff !important;
    }
}

/* Mobile responsive adjustments */
@media screen and (max-width: 600px) {
    .detail-row {
        flex-direction: column;
        text-align: left;
    }
    
    .detail-label,
    .detail-value {
        width: 100% !important;
        text-align: left !important;
        margin-bottom: 4px;
    }
    
    .detail-value {
        font-weight: normal;
        margin-bottom: 12px;
    }
    
    .action-buttons .btn {
        margin: 5px 0 !important;
    }
}
{% endblock %}

{% block email_content %}
<!-- Login Notification Content -->
{% if notification_type == 'suspicious' %}
    <!-- Suspicious Activity Alert -->
    <div class="suspicious-activity">
        <div class="warning-icon">‚ö†Ô∏è</div>
        <h2 style="color: #f44336; margin: 10px 0;">Suspicious Login Activity Detected</h2>
        <p style="font-size: 18px; margin: 10px 0;"><strong>Immediate action required to secure your account</strong></p>
    </div>
    
    <div class="security-alert high-risk">
        <h3 style="margin-top: 0; color: #721c24;">üö® Security Alert</h3>
        <p>We detected a login to your account from an unrecognized device or location. If this was not you, your account may be compromised.</p>
    </div>
    
{% elif notification_type == 'new_device' %}
    <!-- New Device Login -->
    <div class="security-alert">
        <h3 style="margin-top: 0; color: #856404;">üîê New Device Login</h3>
        <p>We noticed a login to your account from a new device. If this was you, no action is needed. If not, please secure your account immediately.</p>
    </div>
    
{% else %}
    <!-- Successful Login Notification -->
    <div class="security-alert success">
        <h3 style="margin-top: 0; color: #155724;">‚úÖ Login Successful</h3>
        <p>Your account was successfully accessed. Here are the details for your security records.</p>
    </div>
{% endif %}

<h1>Login Activity Report</h1>

<p>Hello {{ user_name or 'User' }},</p>

<p>{% if notification_type == 'suspicious' %}We detected potentially suspicious login activity on your account{% elif notification_type == 'new_device' %}We noticed a login from a new device{% else %}There was a recent login to your account{% endif %}. Please review the details below:</p>

<!-- Login Details Section -->
<div class="login-details">
    <h3 style="margin-top: 0; color: #495057;">üìã Login Details</h3>
    
    <div class="detail-row">
        <span class="detail-label">Date & Time:</span>
        <span class="detail-value">{{ login_timestamp or 'Not specified' }}</span>
    </div>
    
    <div class="detail-row">
        <span class="detail-label">IP Address:</span>
        <span class="detail-value">{{ ip_address or 'Unknown' }}</span>
    </div>
    
    <div class="detail-row">
        <span class="detail-label">Location:</span>
        <span class="detail-value">{{ location or 'Unknown location' }}</span>
    </div>
    
    <div class="detail-row">
        <span class="detail-label">Device:</span>
        <span class="detail-value">{{ device_info or 'Unknown device' }}</span>
    </div>
    
    <div class="detail-row">
        <span class="detail-label">Browser:</span>
        <span class="detail-value">{{ browser_info or 'Unknown browser' }}</span>
    </div>
    
    <div class="detail-row">
        <span class="detail-label">Operating System:</span>
        <span class="detail-value">{{ operating_system or 'Unknown OS' }}</span>
    </div>
    
    {% if auth0_session_id %}
    <div class="detail-row">
        <span class="detail-label">Session ID:</span>
        <span class="detail-value">{{ auth0_session_id }}</span>
    </div>
    {% endif %}
    
    {% if risk_score %}
    <div class="detail-row">
        <span class="detail-label">Risk Assessment:</span>
        <span class="detail-value">
            {% if risk_score >= 80 %}üî¥ High Risk{% elif risk_score >= 50 %}üü° Medium Risk{% else %}üü¢ Low Risk{% endif %}
            ({{ risk_score }}/100)
        </span>
    </div>
    {% endif %}
</div>

<!-- Action Buttons -->
{% if notification_type == 'suspicious' or notification_type == 'new_device' %}
<div class="action-buttons">
    <h3>Take Action Now</h3>
    <a href="{{ secure_account_url or '#' }}" class="btn btn-security">üîí Secure My Account</a>
    <a href="{{ change_password_url or '#' }}" class="btn btn-security">üîë Change Password</a>
    <a href="{{ review_sessions_url or '#' }}" class="btn btn-secure-account">üëÅÔ∏è Review Active Sessions</a>
</div>

<!-- Immediate Security Instructions -->
<div class="security-alert high-risk">
    <h3 style="margin-top: 0; color: #721c24;">‚ö° Immediate Security Steps</h3>
    <ol style="margin: 10px 0; padding-left: 20px; text-align: left;">
        <li><strong>Change your password immediately</strong> if you don't recognize this login</li>
        <li><strong>Enable two-factor authentication</strong> for additional security</li>
        <li><strong>Review and revoke</strong> any suspicious active sessions</li>
        <li><strong>Check your account settings</strong> for any unauthorized changes</li>
        <li><strong>Contact our security team</strong> if you need assistance</li>
    </ol>
</div>

{% else %}
<div class="action-buttons">
    <a href="{{ dashboard_url or '#' }}" class="btn btn-primary">üè† Go to Dashboard</a>
    <a href="{{ security_settings_url or '#' }}" class="btn btn-secondary">‚öôÔ∏è Security Settings</a>
</div>
{% endif %}

<!-- Security Tips Section -->
<div class="security-tips">
    <h3 style="margin-top: 0; color: #1976d2;">üõ°Ô∏è Security Best Practices</h3>
    <p>To keep your account secure, we recommend:</p>
    <ul>
        <li><strong>Use a unique, strong password</strong> that you don't use elsewhere</li>
        <li><strong>Enable two-factor authentication (2FA)</strong> for an extra layer of protection</li>
        <li><strong>Regularly review your login activity</strong> in your account settings</li>
        <li><strong>Keep your contact information updated</strong> so we can notify you of security events</li>
        <li><strong>Log out from shared or public devices</strong> after use</li>
        <li><strong>Be cautious of phishing attempts</strong> - we'll never ask for your password via email</li>
    </ul>
</div>

<!-- Auth0 Integration Information -->
{% if auth0_event_id %}
<p style="font-size: 14px; color: #6c757d; margin-top: 30px;">
    <strong>Security Event ID:</strong> {{ auth0_event_id }}<br>
    This notification was generated by our automated security monitoring system powered by Auth0.
</p>
{% endif %}

<!-- Contact Information -->
<div style="background-color: #f8f9fa; border-radius: 6px; padding: 20px; margin: 20px 0; text-align: center;">
    <h3 style="margin-top: 0; color: #495057;">Need Help?</h3>
    <p>If you have questions about this login or need assistance securing your account:</p>
    <p>
        <a href="{{ support_url or '#' }}" class="btn btn-secondary">üìû Contact Security Support</a>
    </p>
    <p style="font-size: 14px; color: #6c757d; margin-bottom: 0;">
        Available 24/7 for security-related concerns<br>
        Response time: Within 15 minutes for high-priority security issues
    </p>
</div>

<!-- Recognition Information -->
<p style="font-size: 14px; color: #6c757d;">
    {% if notification_type == 'suspicious' %}
    <strong>Was this you?</strong> If you recognize this login activity, you can safely ignore this email. 
    However, we recommend reviewing your <a href="{{ security_settings_url or '#' }}">security settings</a> regularly.
    {% else %}
    <strong>Recognize this activity?</strong> If this login was expected, no further action is needed. 
    {% endif %}
</p>

<!-- Footer Security Notice -->
<p style="font-size: 12px; color: #6c757d; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e9ecef;">
    <strong>Security Notice:</strong> This email contains sensitive security information. Please do not forward this email to others. 
    If you believe you received this email in error, please contact our security team immediately.
</p>
{% endblock %}

{% block footer_content %}
<p><strong>{{ company_name or 'Your Application' }} Security Team</strong></p>
<p>
    <a href="{{ dashboard_url or '#' }}">Dashboard</a> |
    <a href="{{ security_settings_url or '#' }}">Security Settings</a> |
    <a href="{{ support_url or '#' }}">Security Support</a> |
    <a href="{{ privacy_url or '#' }}">Privacy Policy</a>
</p>
<p>üîí Your security is our top priority</p>
<p>{{ footer_address or '123 Main Street, City, State 12345' }}</p>
<p style="font-size: 12px; color: #6c757d;">
    This is an automated security notification. Please do not reply to this email.
</p>
{% endblock %}