{% extends "emails/base/email_base.html" %}

{% block title %}Password Reset Request - Your Account{% endblock %}

{% block additional_styles %}
<style>
    /* Password reset specific styles */
    .reset-container {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 12px;
        padding: 30px;
        margin: 30px 0;
        border: 2px solid #dee2e6;
    }

    .reset-icon {
        width: 64px;
        height: 64px;
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
        border-radius: 50%;
        margin: 0 auto 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
    }

    .reset-icon svg {
        width: 32px;
        height: 32px;
        fill: #ffffff;
    }

    .token-info {
        background-color: #fff8e1;
        border: 1px solid #ffcc02;
        border-radius: 8px;
        padding: 20px;
        margin: 25px 0;
        text-align: center;
    }

    .token-info-title {
        font-size: 16px;
        font-weight: 600;
        color: #f57c00;
        margin: 0 0 10px 0;
    }

    .token-info-text {
        font-size: 14px;
        color: #ef6c00;
        margin: 0;
        line-height: 1.4;
    }

    .auth0-badge {
        display: inline-block;
        background-color: #eb5424;
        color: #ffffff;
        font-size: 12px;
        font-weight: 600;
        padding: 6px 12px;
        border-radius: 15px;
        margin: 10px 0;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .backup-instructions {
        background-color: #f1f8ff;
        border-left: 4px solid #0366d6;
        border-radius: 6px;
        padding: 20px;
        margin: 25px 0;
    }

    .backup-title {
        font-size: 16px;
        font-weight: 600;
        color: #0366d6;
        margin: 0 0 10px 0;
    }

    .backup-text {
        font-size: 14px;
        color: #586069;
        margin: 0 0 10px 0;
        line-height: 1.4;
    }

    .backup-link {
        font-family: 'Courier New', Courier, monospace;
        background-color: #f6f8fa;
        border: 1px solid #d1d5da;
        border-radius: 4px;
        padding: 8px 12px;
        font-size: 12px;
        color: #24292e;
        word-break: break-all;
        display: block;
        margin: 10px 0;
    }

    .step-container {
        counter-reset: step-counter;
        margin: 30px 0;
    }

    .step-item {
        counter-increment: step-counter;
        position: relative;
        padding: 15px 0 15px 50px;
        border-left: 2px solid #e1e4e8;
        margin-left: 20px;
    }

    .step-item:last-child {
        border-left: none;
    }

    .step-item::before {
        content: counter(step-counter);
        position: absolute;
        left: -21px;
        top: 15px;
        width: 32px;
        height: 32px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #ffffff;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 14px;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
    }

    .step-title {
        font-size: 16px;
        font-weight: 600;
        color: #24292e;
        margin: 0 0 8px 0;
    }

    .step-description {
        font-size: 14px;
        color: #586069;
        margin: 0;
        line-height: 1.4;
    }

    /* Enhanced security section for password resets */
    .security-enhanced {
        background: linear-gradient(135deg, #f8f9fa 0%, #fff 100%);
        border: 2px solid #28a745;
        border-radius: 8px;
        padding: 25px;
        margin: 30px 0;
    }

    .security-enhanced .security-title {
        color: #155724;
        font-size: 18px;
        margin-bottom: 15px;
    }

    .security-enhanced .security-icon {
        fill: #28a745;
    }

    /* Mobile responsive adjustments */
    @media only screen and (max-width: 600px) {
        .reset-container {
            padding: 20px 15px;
            margin: 20px 0;
        }

        .step-item {
            padding-left: 40px;
            margin-left: 15px;
        }

        .step-item::before {
            left: -18px;
            width: 28px;
            height: 28px;
            font-size: 12px;
        }

        .backup-link {
            font-size: 10px;
            padding: 6px 8px;
        }
    }
</style>
{% endblock %}

{% block header_title %}Password Reset Request{% endblock %}
{% block header_subtitle %}Secure Account Recovery{% endblock %}

{% block content %}
<div class="reset-container">
    <div class="reset-icon">
        <svg viewBox="0 0 24 24">
            <path d="M12,1C18.75,1 21,3.25 21,10C21,16.75 18.75,19 12,19C11.35,19 10.7,18.93 10.11,18.8L7,22H3V18L6.2,14.8C6.07,14.2 6,13.65 6,13C6,6.25 8.25,4 15,4H16V6H15C9.5,6 8,7.5 8,13C8,18.5 9.5,20 15,20C20.5,20 22,18.5 22,13V10C22,2.25 18.75,0 12,0C5.25,0 3,2.25 3,9V10H5V9C5,3.25 6.25,2 12,2C17.75,2 20,3.25 20,10V13C20,17.5 18.5,19 13,19C7.5,19 6,17.5 6,12C6,6.5 7.5,5 13,5H14V3H13C6.25,3 4,5.25 4,12C4,18.75 6.25,21 13,21C19.75,21 22,18.75 22,12V11H20V12C20,17.75 18.75,19 13,19Z"/>
        </svg>
    </div>
    
    <h2 class="content-title">Password Reset Requested</h2>
    
    <p class="content-text">
        Hello{% if user_name %} {{ user_name }}{% endif %},
    </p>
    
    <p class="content-text">
        We received a request to reset the password for your account{% if user_email %} ({{ user_email }}){% endif %}. 
        If you made this request, please click the button below to create a new password.
    </p>

    {% if auth0_enabled %}
    <div class="text-center">
        <span class="auth0-badge">Secured by Auth0</span>
    </div>
    {% endif %}
</div>

<!-- Primary Reset Button -->
<div class="button-container">
    <a href="{{ reset_url }}" class="button" style="text-decoration: none;">
        Reset Your Password
    </a>
</div>

<!-- Token Information -->
<div class="token-info">
    <h3 class="token-info-title">⏰ Important Security Information</h3>
    <p class="token-info-text">
        This password reset link expires in <strong>{{ expiration_hours | default(1) }} hour{% if expiration_hours != 1 %}s{% endif %}</strong>
        {% if expiration_time %} ({{ expiration_time }}){% endif %} for your security.
    </p>
</div>

<!-- Step-by-step instructions -->
<div class="step-container">
    <div class="step-item">
        <h4 class="step-title">Click the Reset Button</h4>
        <p class="step-description">
            Click the "Reset Your Password" button above to open the secure password reset page.
        </p>
    </div>
    
    <div class="step-item">
        <h4 class="step-title">Create a Strong Password</h4>
        <p class="step-description">
            Choose a new password that is at least 8 characters long and includes a mix of letters, numbers, and special characters.
        </p>
    </div>
    
    <div class="step-item">
        <h4 class="step-title">Confirm Your New Password</h4>
        <p class="step-description">
            Enter your new password twice to confirm it's correct, then save your changes.
        </p>
    </div>
    
    <div class="step-item">
        <h4 class="step-title">Sign In with New Password</h4>
        <p class="step-description">
            Use your new password to sign in to your account and verify everything is working correctly.
        </p>
    </div>
</div>

<!-- Alternative access method -->
<div class="backup-instructions">
    <h3 class="backup-title">Can't Click the Button?</h3>
    <p class="backup-text">
        If the button above doesn't work, copy and paste this link into your web browser:
    </p>
    <div class="backup-link">{{ reset_url }}</div>
    <p class="backup-text">
        <strong>Note:</strong> This link contains a secure token and should not be shared with anyone.
    </p>
</div>

<!-- Enhanced security information -->
<div class="security-enhanced">
    <h3 class="security-title">
        <svg class="security-icon" width="20" height="20" viewBox="0 0 24 24">
            <path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,7C13.4,7 14.8,8.6 14.8,10V11H16.5V16H7.5V11H9.2V10C9.2,8.6 10.6,7 12,7M12,8.2C11.2,8.2 10.5,8.7 10.5,10V11H13.5V10C13.5,8.7 12.8,8.2 12,8.2Z"/>
        </svg>
        Security & Privacy Notice
    </h3>
    <div class="security-text">
        <ul style="margin: 0; padding-left: 20px; color: #155724; line-height: 1.6;">
            <li><strong>Secure Request:</strong> This email was generated in response to a password reset request from IP address {% if request_ip %}{{ request_ip }}{% else %}[protected]{% endif %}.</li>
            <li><strong>Token Protection:</strong> The reset link contains a cryptographically signed token that expires automatically for your security.</li>
            <li><strong>One-Time Use:</strong> This link can only be used once. After resetting your password, this link becomes invalid.</li>
            {% if auth0_enabled %}
            <li><strong>Auth0 Integration:</strong> This request is processed through our secure Auth0 authentication service with enterprise-grade security.</li>
            {% endif %}
            <li><strong>Not You?</strong> If you didn't request this password reset, please ignore this email. Your account remains secure.</li>
        </ul>
    </div>
</div>

<!-- Alert for suspicious activity -->
<div class="alert alert-warning">
    <strong>Didn't Request This Reset?</strong><br>
    If you didn't initiate this password reset request, please ignore this email and consider:
    <ul style="margin: 10px 0 0 0; padding-left: 20px;">
        <li>Reviewing your recent account activity</li>
        <li>Ensuring your email account is secure</li>
        <li>Contacting our support team if you notice any suspicious activity</li>
    </ul>
</div>

<!-- Additional security tips -->
<div class="alert alert-info">
    <strong>Password Security Tips:</strong><br>
    <ul style="margin: 10px 0 0 0; padding-left: 20px;">
        <li>Use a unique password that you don't use for other accounts</li>
        <li>Consider using a password manager to generate and store strong passwords</li>
        <li>Enable two-factor authentication if available</li>
        <li>Never share your password or reset links with anyone</li>
    </ul>
</div>

<!-- Support information -->
<div style="text-align: center; margin: 40px 0 20px 0;">
    <p class="content-text">
        <strong>Need Help?</strong><br>
        If you're having trouble resetting your password or have questions about your account security, 
        our support team is here to help.
    </p>
    <div style="margin: 20px 0;">
        <a href="{% if support_url %}{{ support_url }}{% else %}#{% endif %}" class="button button-secondary" style="text-decoration: none;">
            Contact Support
        </a>
    </div>
</div>

{% endblock %}

{% block footer %}
<p class="footer-text">
    This password reset request was initiated on {{ request_timestamp | default('an unknown date') }}
    {% if request_ip %} from IP address {{ request_ip }}{% endif %}.
</p>

<p class="footer-text">
    For your security, this email was sent from an automated, monitored system. 
    Please do not reply to this message.
</p>

<div class="footer-links">
    <a href="{% if privacy_policy_url %}{{ privacy_policy_url }}{% else %}#{% endif %}" class="footer-link">Privacy Policy</a>
    <a href="{% if terms_url %}{{ terms_url }}{% else %}#{% endif %}" class="footer-link">Terms of Service</a>
    <a href="{% if support_url %}{{ support_url }}{% else %}#{% endif %}" class="footer-link">Contact Support</a>
    <a href="{% if security_url %}{{ security_url }}{% else %}#{% endif %}" class="footer-link">Security Center</a>
</div>

<p class="footer-copyright">
    © {% if current_year %}{{ current_year }}{% else %}2024{% endif %} {{ company_name | default('Your Company Name') }}. All rights reserved.<br>
    {% if auth0_enabled %}Secured by Auth0 authentication services.{% endif %}
</p>
{% endblock %}