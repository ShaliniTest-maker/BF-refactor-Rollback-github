{% extends "templates/emails/base/email_base.txt" %}

{% block subject %}
Data Export Completed - {{ export_type }} (Export ID: {{ export_id }})
{% endblock %}

{% block content %}
DATA EXPORT COMPLETION NOTIFICATION
====================================

Export Details:
---------------
Export ID: {{ export_id }}
Export Type: {{ export_type }}
Request Date: {{ request_date.strftime('%Y-%m-%d %H:%M:%S UTC') }}
Completion Date: {{ completion_date.strftime('%Y-%m-%d %H:%M:%S UTC') }}
Processing Duration: {{ processing_duration }}
Requested By: {{ requester_name }} ({{ requester_email }})

Data Summary:
-------------
Total Records Exported: {{ record_count }}
{% if user_data_records -%}
User Data Records: {{ user_data_records }}
{% endif -%}
{% if business_entity_records -%}
Business Entity Records: {{ business_entity_records }}
{% endif -%}
{% if audit_log_records -%}
Audit Log Records: {{ audit_log_records }}
{% endif -%}
Data Classification: {{ data_classification }}
Export Format: {{ export_format }}

File Information:
-----------------
{% for file in export_files %}
File {{ loop.index }}: {{ file.filename }}
  Location: {{ file.secure_path }}
  Size: {{ file.size_formatted }}
  Checksum (SHA-256): {{ file.checksum }}
  Encryption: {{ file.encryption_status }}
{% endfor %}

Security and Compliance:
------------------------
Encryption Status: {{ encryption_details.status }}
{% if encryption_details.algorithm -%}
Encryption Algorithm: {{ encryption_details.algorithm }}
Key Management: {{ encryption_details.key_management }}
{% endif -%}

Access Controls:
- File access restricted to authorized personnel only
- Download link expires: {{ download_expiry.strftime('%Y-%m-%d %H:%M:%S UTC') }}
- Access attempts will be logged and monitored

GDPR Compliance Information:
---------------------------
{% if gdpr_request_type -%}
Request Type: {{ gdpr_request_type }}
Legal Basis: {{ legal_basis }}
Data Subject Rights: {{ data_subject_rights }}
{% endif -%}
Compliance Validation: {{ compliance_status }}
Data Retention Period: {{ retention_period }}
{% if pseudonymization_applied -%}
Pseudonymization Applied: Yes
Pseudonymization Method: {{ pseudonymization_method }}
{% endif -%}

Next Steps for Administrators:
------------------------------
1. Verify export file integrity using provided checksums
2. Review compliance validation results
3. Coordinate secure delivery to authorized recipient
{% if gdpr_request_type == 'Subject Access Request' -%}
4. Prepare data subject communication within required timeframe
{% endif -%}
{% if manual_review_required -%}
5. MANUAL REVIEW REQUIRED: {{ manual_review_reason }}
{% endif -%}

Download Access:
----------------
Secure Download URL: {{ secure_download_url }}
Access Token: {{ access_token }}

IMPORTANT: This URL is valid until {{ download_expiry.strftime('%Y-%m-%d %H:%M:%S UTC') }}
Access is logged and monitored for security compliance.

Administrative Actions:
-----------------------
{% if requires_approval -%}
⚠️  APPROVAL REQUIRED: This export requires management approval before delivery
Approval URL: {{ approval_url }}
{% endif -%}

For export verification or issues:
- Export Dashboard: {{ dashboard_url }}
- Administrative Contact: {{ admin_contact_email }}
- Security Team: {{ security_contact_email }}

Operational Notes:
------------------
{% if export_notes -%}
{{ export_notes }}
{% endif -%}
Database Performance Impact: {{ performance_impact }}
System Resources Used: {{ resource_usage }}

This export was generated by the Flask Data Export Service as part of our
compliance and administrative reporting infrastructure.

All export activities are logged in accordance with our data governance
policies and regulatory requirements.

{% endblock %}

{% block footer %}
---
Flask Application Data Export Service
Compliance and Administrative Reporting System

This is an automated notification. Please do not reply to this email.

For technical support or questions regarding this export:
- Administrative Dashboard: {{ base_url }}/admin/exports
- Support Email: {{ support_email }}
- Security Issues: {{ security_email }}

Data Export ID: {{ export_id }}
Generated: {{ completion_date.strftime('%Y-%m-%d %H:%M:%S UTC') }}

CONFIDENTIAL: This email contains sensitive data export information.
Handle in accordance with organizational data protection policies.
{% endblock %}